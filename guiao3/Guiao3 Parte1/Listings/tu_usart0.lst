C51 COMPILER V9.60.7.0   TU_USART0                                                         11/20/2023 15:41:41 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE TU_USART0
OBJECT MODULE PLACED IN .\Objects\tu_usart0.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE tu_usart0.c OPTIMIZE(0,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings
                    -\tu_usart0.lst) TABS(2) OBJECT(.\Objects\tu_usart0.obj)

line level    source

   1          #include <REG51F380.H>
   2          #include <stdio.h>
   3          #include "config_platform.h"
   4          #include "serialIO.h"
   5          
   6          sbit PB1 = P0 ^ 6;
   7          sbit PB2 = P0 ^ 7;
   8          sbit seg_dp = P2^7;
   9          
  10          unsigned char i;
  11          unsigned char button1pressed; // flags se os botoes sao clicados
  12          unsigned char button2pressed;
  13          unsigned char blink = 50;
  14          
  15          
  16          // vetor dos dos numeros 16 eletemnos {0xC0, 0xF9, 0xA4, 0xB0, 0x99, 0x92, 0x82, 0xF8, 0x80, 0x90, 0x88, 0
             -x83, 0xC6, 0xA1, 0x86, 0x8E};
  17          unsigned char vetor[16] =             {0x40, 0x79, 0x24, 0x30, 0x19, 0x12, 0x02, 0x78, 0x00, 0x10, 0x88, 0x83, 0
             -xC6, 0xA1, 0x86, 0x8E};
  18          
  19          // DEBOUNCE
  20          unsigned int debounce(bit PB) {
  21   1        char window;
  22   1        unsigned int j;
  23   1        for (j = 0; j < 8; j++)
  24   1        {
  25   2          window = (window << 1) | PB;
  26   2        }
  27   1        return window;
  28   1      }
  29          
  30          void timer2_init_auto(int reload){
  31   1      
  32   1        TMR2CN = 0;
  33   1      
  34   1        #define B_T2MH 5  
  35   1      
  36   1        CKCON &= ~((1 << B_T2MH));
  37   1        
  38   1        TMR2H = (reload) >> 8;
  39   1        TMR2L = (reload);
  40   1      
  41   1        TMR2RLH = (reload) >> 8;
  42   1        TMR2RLL = (reload);
  43   1        
  44   1      }
  45          
  46          void timer2_isr(void) interrupt 5 using 2 {
  47   1        
  48   1        char P2_state;
  49   1        P2_state = P2;
  50   1        
  51   1        // sysclock /12 = 4MHz
  52   1        // 1s 4,000,000 ticks!
C51 COMPILER V9.60.7.0   TU_USART0                                                         11/20/2023 15:41:41 PAGE 2   

  53   1        // 10ms => 40000 ticks!
  54   1        // 50 ciclos = 500ms
  55   1      
  56   1        
  57   1        if(--blink == 0){
  58   2          //P2 = P2_state ^ (1 << 7);
  59   2          seg_dp = 1;
  60   2          blink = 50;
  61   2        }
  62   1        
  63   1          
  64   1        TF2H = 0; 
  65   1      }
  66          
  67          
  68          void main(void) {
  69   1        char c = 0;
  70   1        i = 0;
  71   1        button1pressed = 0; // flag se o botao ? clicado
  72   1        button2pressed = 0; // flag se o botao ? clicado
  73   1        
  74   1        Init_Device();
  75   1        uart0_initialize();
  76   1        timer2_init_auto(-40000);
  77   1        TF2H = 0; 
  78   1        ET2 = 1;
  79   1        TR2 = 1;
  80   1        EA = 1;
  81   1      
  82   1        
  83   1        while (1) {
  84   2          c = _getkey2();
  85   2      
  86   2          // incrementar
  87   2          if (debounce(!PB1) && !button1pressed) {
  88   3      
  89   3            if (i < 15) {
  90   4              i++;
  91   4            }
  92   3            else {
  93   4              i = 15;
  94   4            }
  95   3            putchar(i);
  96   3            putchar('\n');
  97   3            button1pressed = 1;
  98   3          }
  99   2          if (!debounce(!PB1)) { // reset a flag se o botao ? clicado
 100   3            button1pressed = 0;
 101   3          }
 102   2      
 103   2          if (c == 0x2b || c == 0x49 || c == 0x69) {
 104   3            if (i < 15) {
 105   4              i++;
 106   4            }
 107   3            else {
 108   4              i = 15;
 109   4            }
 110   3            putchar(i);
 111   3            putchar('\n');
 112   3          }
 113   2      
 114   2          // decrementar
C51 COMPILER V9.60.7.0   TU_USART0                                                         11/20/2023 15:41:41 PAGE 3   

 115   2          if (debounce(!PB2) && !button2pressed) {
 116   3      
 117   3            if (i > 0) {
 118   4              i--;
 119   4            }
 120   3            else {
 121   4              i = 0;
 122   4            }
 123   3            putchar(i);
 124   3            putchar('\n');
 125   3            button2pressed = 1;
 126   3          }
 127   2          if (!debounce(!PB2)) {
 128   3            button2pressed = 0;
 129   3          }
 130   2      
 131   2          if (c == 0x2d || c == 0x44 || c == 0x64) {
 132   3            if (i > 0) {
 133   4              i--;
 134   4            }
 135   3            else {
 136   4              i = 0;
 137   4            }
 138   3            putchar(i);
 139   3            putchar('\n');
 140   3          }
 141   2          
 142   2          P2 = vetor[i];
 143   2          
 144   2        }
 145   1      }
 146          
 147          
 148          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    361    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     27    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      1    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
