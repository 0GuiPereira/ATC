C51 COMPILER V9.60.7.0   PROJETO                                                           11/04/2023 20:08:48 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE PROJETO
OBJECT MODULE PLACED IN .\Objects\projeto.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE projeto.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\p
                    -rojeto.lst) TABS(2) OBJECT(.\Objects\projeto.obj)

line level    source

   1          #include <REG51F380.H>
   2          #define ENABLE_UART0 (ES0 = 1)
   3          #define DISABLE_UART0 (ES0 = 0)
   4          #define BUFFERSIZE 0xff
   5          // Dados existentes em cada um dos buffers
   6          extern volatile unsigned char TxNumberOfData;
   7          extern volatile unsigned char RxNumberOfData;
   8          // Apontadores para o buffers circular
   9          unsigned char TxBufWritePtr=0, RxBufReadPtr=0;
  10          // Buffers de tranmissao e rececao
  11          volatile unsigned char TxBuffer[BUFFERSIZE];
  12          volatile unsigned char RxBuffer[BUFFERSIZE];
  13          // Apontadores de leitura no buffer TxBuffer
  14          volatile unsigned char TxBufReadPtr=0;
  15          // Apontadores de escrita no buffer RxBuffer
  16          volatile unsigned char RxBufWritePtr=0;
  17          // Dados existentes em cada um dos buffers
  18          volatile unsigned char TxNumberOfData=0;
  19          volatile unsigned char RxNumberOfData=0;
  20          
  21          void configUART0(void) {
  22   1          P0MDOUT |= 0x10; //Ativa Push-pull
  23   1          //no pino TX (recomendado)
  24   1          //Configurar timer1
  25   1          //Segundo a tabela 23.1 do manual do micro
  26   1          //(SYSCLK=24MHz)
  27   1          CKCON |= 0x08; //T1M=0 >> 155200bps.
  28   1          //Comentar p/ 9600bps
  29   1          TH1 = 0x98; //Valor de autoreload
  30   1          // p/ 115200 e 9600
  31   1      
  32   1          //Selecao e ativacao do timer
  33   1          TMOD |= 0x20; //Timer1, modo2 (autorelaod)
  34   1          TR1 = 1; //TCON |=0x40 >> Ativa timer
  35   1      
  36   1          //Configurar porta serie (SCON)
  37   1          REN0 = 1; //SCON0 |=0x10 >> Ativa rececao timer0
  38   1          //Interrupcoes
  39   1          ES0 = 1; //Ativa a interr da porta serie (Reg IE.4)
  40   1          EA = 1; //Ativa globalmente as interr. (Reg IE.7)
  41   1      }
  42          
  43          unsigned char readUART(unsigned char *value) {
  44   1          DISABLE_UART0;
  45   1          switch (RxNumberOfData) {
  46   2              BUFFEREMPTY:
  47   2              ENABLE_UART0;
  48   2              return 0;
  49   2              default:
  50   2              RxNumberOfData--;
  51   2              *value=RxBuffer[RxBufReadPtr];
  52   2              RxBufReadPtr = (RxBufReadPtr+1) % BUFFERSIZE;
  53   2          }
  54   1          ENABLE_UART0;
C51 COMPILER V9.60.7.0   PROJETO                                                           11/04/2023 20:08:48 PAGE 2   

  55   1          return 1;
  56   1      }
*** WARNING C280 IN LINE 46 OF projeto.c: 'BUFFEREMPTY': unreferenced label
  57          
  58          unsigned char writeUART(unsigned char value) {
  59   1          DISABLE_UART0;
  60   1          switch (TxNumberOfData) {
  61   2              BUFFERFULL:
  62   2              ENABLE_UART0;
  63   2              return 0;
  64   2              BUFFEREMPTY :
  65   2              sbuf = value;
*** ERROR C202 IN LINE 65 OF projeto.c: 'sbuf': undefined identifier
  66   2              break;
  67   2              default:
  68   2              //TxNumberOfData++;
  69   2              TxBuffer[TxBufWritePtr]=value;
  70   2              TxBufWritePtr = (TxBufWritePtr+1) % BUFFERSIZE;
  71   2          }
  72   1          TxNumberOfData++;
  73   1          ENABLE_UART0;
  74   1          return 1;
  75   1      }
  76          
  77          void UARTInterrupt(void) __interrupt (4)0 {
*** ERROR C141 IN LINE 77 OF projeto.c: syntax error near '4', expected 'bit'
*** ERROR C132 IN LINE 77 OF projeto.c: '__interrupt': not in formal parameter list
*** ERROR C141 IN LINE 77 OF projeto.c: syntax error near '0', expected ';'
  78              if (RI) {
*** ERROR C132 IN LINE 78 OF projeto.c: 'RI': not in formal parameter list
*** ERROR C141 IN LINE 78 OF projeto.c: syntax error near '{', expected ';'
  79                  RI=0;
*** ERROR C244 IN LINE 79 OF projeto.c: 'RI': can't initialize, bad type or class
*** ERROR C132 IN LINE 79 OF projeto.c: 'RI': not in formal parameter list
  80                  if (RxNumberOfData < BUFFERSIZE) {
*** ERROR C141 IN LINE 80 OF projeto.c: syntax error near 'if', expected 'hdata'
*** ERROR C141 IN LINE 80 OF projeto.c: syntax error near '<', expected ')'
  81                      RxBuffer[RxBufWritePtr]=SBUF;
*** ERROR C221 IN LINE 81 OF projeto.c: non-constant case/dim expression
*** ERROR C231 IN LINE 81 OF projeto.c: 'RxBuffer': redefinition
*** ERROR C202 IN LINE 81 OF projeto.c: 'SBUF': undefined identifier
  82                      RxWritePtr = (RxBufWritePtr +1) % BUFFERSIZE;
*** ERROR C247 IN LINE 82 OF projeto.c: non-address/-constant initializer
  83                      RxNumberOfData++;
*** ERROR C129 IN LINE 83 OF projeto.c: missing ';' before '++'
  84                  }
  85              }
  86              if (TI) {
  87                  TI=0;
  88                  TxNumberOfData--;
  89                  if (TxNumberOfData) {
  90                      SBUF=TxBuffer[TxBufReadPtr];
  91                      TxReadPtr = (TxBufReadPtr +1) % BUFFERSIZE;
  92                      //TxNumberOfData--;
  93                  }
  94              }
  95          }
  96          
  97          void main (void) {
  98              char hello[] = "Hello World";
  99              char *chr = hello;
 100              char chr_r;
C51 COMPILER V9.60.7.0   PROJETO                                                           11/04/2023 20:08:48 PAGE 3   

 101              XBR0 |= 0x01; //Ativa UART0 no crossbar
 102              XBR1 |= 0x40; //Ativa crossbar
 103              CLKSEL |= 0x02; //SYSCLK derivado do
 104              // Oscil/2=24MHz
 105              configUART0();
 106              while (*chr) {
 107                  writeUART(*chr);
 108                  chr++;
 109              }
 110              while (1) {
 111                  while (readUART(chr_r))
 112                  writeUART(chr_r);
 113                  else {
 114                      chr = hello;
 115                      while (*chr) {
 116                          writeUART(*chr);
 117                          chr++;
 118                      }
 119                  }
 120              }
 121          }

C51 COMPILATION COMPLETE.  1 WARNING(S),  15 ERROR(S)
